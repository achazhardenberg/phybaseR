<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Custom Priors and Mechanistic Constraints • because</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Custom Priors and Mechanistic Constraints">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">because</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/01_getting_started.html">Getting Started with because</a></li>
    <li><a class="dropdown-item" href="../articles/02_dseparation.html">Causal inference with d-separation</a></li>
    <li><a class="dropdown-item" href="../articles/03_phylogenetic_models.html">Phylogenetic Models</a></li>
    <li><a class="dropdown-item" href="../articles/04_missing_data.html">Missing Data Imputation in because</a></li>
    <li><a class="dropdown-item" href="../articles/05_custom_priors.html">Custom Priors and Mechanistic Constraints</a></li>
    <li><a class="dropdown-item" href="../articles/06_mediation.html">06. Automated Mediation Analysis</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/because-pkg/because/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Custom Priors and Mechanistic Constraints</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/because-pkg/because/blob/master/vignettes/05_custom_priors.Rmd" class="external-link"><code>vignettes/05_custom_priors.Rmd</code></a></small>
      <div class="d-none name"><code>05_custom_priors.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>One of the strengths of Bayesian modeling is the ability to
incorporate prior knowledge into your analysis. In the
<code>because</code> package, we generally use “uninformative” or weakly
informative priors by default to let the data speak for itself. However,
there are many cases where you might want to inject specific
information:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Mechanistic Knowledge</strong>: You know a parameter (like a
growth rate) must be positive or lies within a biologically feasible
range.</li>
<li>
<strong>Previous Studies</strong>: You have estimates from a
previous meta-analysis or experiment that you want to use as a starting
point.</li>
<li>
<strong>Measurement Error</strong>: You know the measurement error
of an instrument and want to fix or constrain the residual
variance.</li>
</ol>
<p>This vignette demonstrates how to use the <code>priors</code>
argument in <code><a href="../reference/because.html">because()</a></code> to override default priors and inject
your own mechanistic constraints.</p>
</div>
<div class="section level2">
<h2 id="example-1-comparing-default-and-custom-priors">Example 1: Comparing Default and Custom Priors<a class="anchor" aria-label="anchor" href="#example-1-comparing-default-and-custom-priors"></a>
</h2>
<p>For this example, let’s simulate <strong>Absolute Growth
Rate</strong> in <strong>grams per day (g/day)</strong> for hypothetical
juvenile birds responding to ambient temperature.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://because-pkg.github.io/because/">because</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="co"># Ambient temperature in Celsius (Mean 20C)</span></span>
<span><span class="va">Temp_Raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, mean <span class="op">=</span> <span class="fl">20</span>, sd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Center it so '0' represents the mean (20C).</span></span>
<span><span class="co"># This ensures the intercept represents growth at average conditions,</span></span>
<span><span class="co"># rather than at 0°C (where the bird would be frozen solid!).</span></span>
<span><span class="va">Temp_Centered</span> <span class="op">&lt;-</span> <span class="va">Temp_Raw</span> <span class="op">-</span> <span class="fl">20</span></span>
<span></span>
<span><span class="co"># True relationship:</span></span>
<span><span class="co"># Baseline growth at mean temp is 10 g/day.</span></span>
<span><span class="co"># Every degree of warming above mean adds 0.5 g/day.</span></span>
<span><span class="va">Growth_g_day</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">Temp_Centered</span> <span class="op">+</span> <span class="fl">10</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">Temp_Centered</span>, <span class="va">Growth_g_day</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="default-model">Default Model<a class="anchor" aria-label="anchor" href="#default-model"></a>
</h3>
<p>Let’s fit a standard model first. By default, <code>because</code>
assigns wide Gaussian priors (<code>dnorm(0, 1.0E-6)</code>) to
intercepts (<code>alpha</code>) and slopes (<code>beta</code>), and
Gamma priors (<code>dgamma(1, 1)</code>) to precisions
(<code>tau</code>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_default</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/because.html">because</a></span><span class="op">(</span></span>
<span>    equations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Growth_g_day</span> <span class="op">~</span> <span class="va">Temp_Centered</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">df</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; No tree provided. Running standard (non-phylogenetic) SEM.</span></span>
<span><span class="co">#&gt; Converted data.frame to list with 2 variables: Growth_g_day, Temp_Centered</span></span>
<span><span class="co">#&gt; Compiling model graph</span></span>
<span><span class="co">#&gt;    Resolving undeclared variables</span></span>
<span><span class="co">#&gt;    Allocating nodes</span></span>
<span><span class="co">#&gt; Graph information:</span></span>
<span><span class="co">#&gt;    Observed stochastic nodes: 30</span></span>
<span><span class="co">#&gt;    Unobserved stochastic nodes: 3</span></span>
<span><span class="co">#&gt;    Total graph size: 1059</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Initializing model</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_default</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                  Mean    SD Naive SE Time-series SE  2.5%   50%</span></span>
<span><span class="co">#&gt; alphaGrowth_g_day               9.779 0.388    0.007          0.007 9.006 9.784</span></span>
<span><span class="co">#&gt; beta_Growth_g_day_Temp_Centered 0.432 0.063    0.001          0.001 0.312 0.432</span></span>
<span><span class="co">#&gt; sigmaGrowth_g_day               2.085 0.278    0.005          0.005 1.623 2.060</span></span>
<span><span class="co">#&gt;                                  97.5% Rhat n.eff</span></span>
<span><span class="co">#&gt; alphaGrowth_g_day               10.550    1  3114</span></span>
<span><span class="co">#&gt; beta_Growth_g_day_Temp_Centered  0.561    1  3000</span></span>
<span><span class="co">#&gt; sigmaGrowth_g_day                2.702    1  2957</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; DIC:</span></span>
<span><span class="co">#&gt; Mean deviance:  130.4 </span></span>
<span><span class="co">#&gt; penalty 3.146 </span></span>
<span><span class="co">#&gt; Penalized deviance: 133.5</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="custom-prior-model">Custom Prior Model<a class="anchor" aria-label="anchor" href="#custom-prior-model"></a>
</h3>
<p>Now, suppose we have strong prior knowledge from scaling theory or
previous literature: 1. <strong>Intercept (Alpha)</strong>: At
<strong>mean temperatures</strong> (20°C), metabolic constraints suggest
growth should be around <strong>10 g/day</strong>. 2. <strong>Slope
(Beta)</strong>: We expect a positive effect of temperature, likely
around <strong>0.5 g/day/°C</strong>.</p>
<p>The parameter names usually follow this convention:</p>
<p><strong>Intercepts</strong>: <code>alphaResponseVariable</code>
(e.g., <code>alphaGrowth_g_day</code>)</p>
<p><strong>Slopes</strong>: <code>beta_Response_Predictor</code> (e.g.,
<code>beta_Growth_g_day_Temp_Centered</code>)</p>
<p><strong>Residual precision:</strong> <code>tau_e_Response</code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define our custom priors</span></span>
<span><span class="va">my_priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co"># Strong prior on intercept: Mean 10, Precision 100 (SD = 0.1)</span></span>
<span>    alphaGrowth_g_day <span class="op">=</span> <span class="st">"dnorm(10, 100)"</span>,</span>
<span></span>
<span>    <span class="co"># Informative prior on slope: Mean 0.5, Precision 400 (SD = 0.05)</span></span>
<span>    beta_Growth_g_day_Temp_Centered <span class="op">=</span> <span class="st">"dnorm(0.5, 400)"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/because.html">because</a></span><span class="op">(</span></span>
<span>    equations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Growth_g_day</span> <span class="op">~</span> <span class="va">Temp_Centered</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">df</span>,</span>
<span>    priors <span class="op">=</span> <span class="va">my_priors</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; No tree provided. Running standard (non-phylogenetic) SEM.</span></span>
<span><span class="co">#&gt; Converted data.frame to list with 2 variables: Growth_g_day, Temp_Centered</span></span>
<span><span class="co">#&gt; Compiling model graph</span></span>
<span><span class="co">#&gt;    Resolving undeclared variables</span></span>
<span><span class="co">#&gt;    Allocating nodes</span></span>
<span><span class="co">#&gt; Graph information:</span></span>
<span><span class="co">#&gt;    Observed stochastic nodes: 30</span></span>
<span><span class="co">#&gt;    Unobserved stochastic nodes: 3</span></span>
<span><span class="co">#&gt;    Total graph size: 1061</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Initializing model</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_custom</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                  Mean    SD Naive SE Time-series SE  2.5%   50%</span></span>
<span><span class="co">#&gt; alphaGrowth_g_day               9.980 0.095    0.002          0.002 9.799 9.978</span></span>
<span><span class="co">#&gt; beta_Growth_g_day_Temp_Centered 0.471 0.038    0.001          0.001 0.398 0.470</span></span>
<span><span class="co">#&gt; sigmaGrowth_g_day               2.065 0.274    0.005          0.005 1.610 2.040</span></span>
<span><span class="co">#&gt;                                  97.5% Rhat n.eff</span></span>
<span><span class="co">#&gt; alphaGrowth_g_day               10.166    1  2902</span></span>
<span><span class="co">#&gt; beta_Growth_g_day_Temp_Centered  0.547    1  3000</span></span>
<span><span class="co">#&gt; sigmaGrowth_g_day                2.678    1  3096</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; DIC:</span></span>
<span><span class="co">#&gt; Mean deviance:  129.6 </span></span>
<span><span class="co">#&gt; penalty 1.508 </span></span>
<span><span class="co">#&gt; Penalized deviance: 131.1</span></span></code></pre></div>
<p>Notice how the credible intervals for the custom model will be
tighter and centered closer to our priors, especially if the data were
sparse (small N).</p>
</div>
<div class="section level3">
<h3 id="visualizing-the-impact">Visualizing the Impact<a class="anchor" aria-label="anchor" href="#visualizing-the-impact"></a>
</h3>
<p>We can plot the posterior estimates together to see the “shrinkage”
effect of our informative priors.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can use the helper function plot_posterior() to compare models.</span></span>
<span><span class="co"># By passing a list of models, they are overlaid on the same plot.</span></span>
<span><span class="co"># The 'parameter' argument uses partial matching (regex), so "Growth_g_day"</span></span>
<span><span class="co"># will match both the intercept (alphaGrowth_g_day) and the slope (beta_Growth_g_day...).</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_posterior.html">plot_posterior</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Default"</span> <span class="op">=</span> <span class="va">fit_default</span>, <span class="st">"Custom"</span> <span class="op">=</span> <span class="va">fit_custom</span><span class="op">)</span>,</span>
<span>    parameter <span class="op">=</span> <span class="st">"Growth_g_day"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="05_custom_priors_files/figure-html/plot_compare-1.png" class="r-plt" width="864"></p>
</div>
</div>
<div class="section level2">
<h2 id="example-2-mechanistic-constraints">Example 2: Mechanistic Constraints<a class="anchor" aria-label="anchor" href="#example-2-mechanistic-constraints"></a>
</h2>
<p>In many biological contexts, a negative effect is not just unlikely,
it is <strong>physically impossible</strong>.</p>
<p>For example, consider the relationship between <strong>Body
Mass</strong> and <strong>Metabolic Rate</strong> (Kleiber’s Law). A
larger animal simply cannot consume <em>less</em> energy than a smaller
one (a negative slope), all else equal. The physics of life requires
costs to scale positively with mass.</p>
<p>However, if our sample size is small and measurement error is huge,
we might accidentally estimate a negative slope. We can prevent this by
enforcing a positive prior.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate data following Kleiber's Law: MR = a * Mass^0.75</span></span>
<span><span class="co"># Taking logs: log(MR) = log(a) + 0.75 * log(Mass)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">Mass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">10</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="co"># True scaling exponent is 0.75</span></span>
<span><span class="co"># We add enough noise that the estimated slope might be negative by chance</span></span>
<span><span class="va">Log_Mass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Mass</span><span class="op">)</span></span>
<span><span class="va">Log_MR</span> <span class="op">&lt;-</span> <span class="fl">1.5</span> <span class="op">+</span> <span class="fl">0.75</span> <span class="op">*</span> <span class="va">Log_Mass</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">30</span>, sd <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_kleiber</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">Log_Mass</span>, <span class="va">Log_MR</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prior: The scaling exponent (slope) must be positive</span></span>
<span><span class="co"># Physics dictates that metabolic cost increases with mass.</span></span>
<span><span class="va">positive_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    beta_Log_MR_Log_Mass <span class="op">=</span> <span class="st">"dnorm(0, 1) T(0, )"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1. Fit Default Model (Unconstrained) - Log-Log regression</span></span>
<span><span class="va">fit_default_kleiber</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/because.html">because</a></span><span class="op">(</span></span>
<span>    equations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Log_MR</span> <span class="op">~</span> <span class="va">Log_Mass</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">df_kleiber</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; No tree provided. Running standard (non-phylogenetic) SEM.</span></span>
<span><span class="co">#&gt; Converted data.frame to list with 2 variables: Log_MR, Log_Mass</span></span>
<span><span class="co">#&gt; Compiling model graph</span></span>
<span><span class="co">#&gt;    Resolving undeclared variables</span></span>
<span><span class="co">#&gt;    Allocating nodes</span></span>
<span><span class="co">#&gt; Graph information:</span></span>
<span><span class="co">#&gt;    Observed stochastic nodes: 30</span></span>
<span><span class="co">#&gt;    Unobserved stochastic nodes: 3</span></span>
<span><span class="co">#&gt;    Total graph size: 1059</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Initializing model</span></span>
<span></span>
<span><span class="co"># 2. Fit Mechanistic Model (Constrained)</span></span>
<span><span class="va">fit_mech_kleiber</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/because.html">because</a></span><span class="op">(</span></span>
<span>    equations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Log_MR</span> <span class="op">~</span> <span class="va">Log_Mass</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">df_kleiber</span>,</span>
<span>    priors <span class="op">=</span> <span class="va">positive_prior</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; No tree provided. Running standard (non-phylogenetic) SEM.</span></span>
<span><span class="co">#&gt; Converted data.frame to list with 2 variables: Log_MR, Log_Mass</span></span>
<span><span class="co">#&gt; Compiling model graph</span></span>
<span><span class="co">#&gt;    Resolving undeclared variables</span></span>
<span><span class="co">#&gt;    Allocating nodes</span></span>
<span><span class="co">#&gt; Graph information:</span></span>
<span><span class="co">#&gt;    Observed stochastic nodes: 30</span></span>
<span><span class="co">#&gt;    Unobserved stochastic nodes: 3</span></span>
<span><span class="co">#&gt;    Total graph size: 1059</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Initializing model</span></span>
<span></span>
<span><span class="co"># Compare Estimates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_default_kleiber</span><span class="op">)</span></span>
<span><span class="co">#&gt;                        Mean    SD Naive SE Time-series SE   2.5%   50%  97.5%</span></span>
<span><span class="co">#&gt; alphaLog_MR           3.682 4.525    0.083          0.310 -5.423 3.668 12.168</span></span>
<span><span class="co">#&gt; beta_Log_MR_Log_Mass -0.001 1.106    0.020          0.076 -2.138 0.009  2.219</span></span>
<span><span class="co">#&gt; sigmaLog_MR           2.953 0.394    0.007          0.008  2.283 2.914  3.895</span></span>
<span><span class="co">#&gt;                       Rhat n.eff</span></span>
<span><span class="co">#&gt; alphaLog_MR          1.001   220</span></span>
<span><span class="co">#&gt; beta_Log_MR_Log_Mass 1.001   220</span></span>
<span><span class="co">#&gt; sigmaLog_MR          1.000  2712</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; DIC:</span></span>
<span><span class="co">#&gt; Mean deviance:  151.1 </span></span>
<span><span class="co">#&gt; penalty 3.152 </span></span>
<span><span class="co">#&gt; Penalized deviance: 154.2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_mech_kleiber</span><span class="op">)</span></span>
<span><span class="co">#&gt;                       Mean    SD Naive SE Time-series SE   2.5%   50% 97.5%</span></span>
<span><span class="co">#&gt; alphaLog_MR          1.432 1.792    0.033          0.056 -2.759 1.719 3.953</span></span>
<span><span class="co">#&gt; beta_Log_MR_Log_Mass 0.555 0.425    0.008          0.013  0.026 0.476 1.577</span></span>
<span><span class="co">#&gt; sigmaLog_MR          2.910 0.383    0.007          0.007  2.263 2.883 3.728</span></span>
<span><span class="co">#&gt;                       Rhat n.eff</span></span>
<span><span class="co">#&gt; alphaLog_MR          1.000  1039</span></span>
<span><span class="co">#&gt; beta_Log_MR_Log_Mass 1.000  1022</span></span>
<span><span class="co">#&gt; sigmaLog_MR          1.001  3000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; DIC:</span></span>
<span><span class="co">#&gt; Mean deviance:  150.5 </span></span>
<span><span class="co">#&gt; penalty 2.252 </span></span>
<span><span class="co">#&gt; Penalized deviance: 152.8</span></span>
<span></span>
<span><span class="co"># Visualize: Unconstrained vs. Truncated</span></span>
<span><span class="fu"><a href="../reference/plot_posterior.html">plot_posterior</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Unconstrained <span class="op">=</span> <span class="va">fit_default_kleiber</span>, Mechanistic <span class="op">=</span> <span class="va">fit_mech_kleiber</span><span class="op">)</span>,</span>
<span>    parameter <span class="op">=</span> <span class="st">"beta_Log_MR_Log_Mass"</span>,</span>
<span>    density_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Mechanistic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="05_custom_priors_files/figure-html/mechanistic_constraint-1.png" class="r-plt" width="700"></p>
</div>
<div class="section level2">
<h2 id="example-3-informing-residual-variance-components">Example 3: Informing Residual Variance components<a class="anchor" aria-label="anchor" href="#example-3-informing-residual-variance-components"></a>
</h2>
<p>We usually estimate the residual variance (<code>sigma</code> or its
inverse <code>tau</code>) from the data. However, you might have prior
knowledge about the expected noise level.</p>
<blockquote>
<p>[!NOTE] <strong>Distinction from <code>variability</code>
argument</strong>: The <code>variability</code> argument in
<code><a href="../reference/because.html">because()</a></code> is designed for <strong>Measurement
Error</strong> in predictors (Error-in-Variables) or when you have
repeated measures per individual.</p>
<p>Custom priors on <code>tau_e</code>, shown below, are for providing
information about the <strong>Residual Variance</strong> of the response
variable (which includes both Process Error and unrecognized Observation
Error).</p>
</blockquote>
<p>For example, if you know the precision of your scale is roughly 2 g,
this gives you a strong expectation for the residual standard deviation
(sigma).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate small, noisy dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">N_small</span> <span class="op">&lt;-</span> <span class="fl">15</span></span>
<span><span class="va">Temp_Small</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N_small</span>, <span class="fl">20</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co"># Actual residual SD = 3 (quite noisy)</span></span>
<span><span class="va">Growth_Small</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">Temp_Small</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N_small</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">df_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Growth_g_day <span class="op">=</span> <span class="va">Growth_Small</span>, Temp_Centered <span class="op">=</span> <span class="va">Temp_Small</span> <span class="op">-</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1. Default Model (Weak Prior)</span></span>
<span><span class="co"># The data (SD=3) will dominate, finding a sigma around 3 with wide uncertainty.</span></span>
<span><span class="va">fit_default_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/because.html">because</a></span><span class="op">(</span></span>
<span>    equations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Growth_g_day</span> <span class="op">~</span> <span class="va">Temp_Centered</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">df_small</span>,</span>
<span>    quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Constrained Model (Strong Prior)</span></span>
<span><span class="co"># Suppose we have theoretical reasons to believe residual SD should be small (~1.0).</span></span>
<span><span class="co"># Precision = 1/1^2 = 1.</span></span>
<span><span class="co"># dgamma(20, 20) -&gt; Mean 1, Variance 0.05 (Strong)</span></span>
<span><span class="va">variance_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    tau_e_Growth_g_day <span class="op">=</span> <span class="st">"dgamma(20, 20)"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_constrained_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/because.html">because</a></span><span class="op">(</span></span>
<span>    equations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Growth_g_day</span> <span class="op">~</span> <span class="va">Temp_Centered</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">df_small</span>,</span>
<span>    priors <span class="op">=</span> <span class="va">variance_prior</span>,</span>
<span>    quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize: The constrained posterior will be shifted left (towards 1) and sharper</span></span>
<span><span class="fu"><a href="../reference/plot_posterior.html">plot_posterior</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Default <span class="op">=</span> <span class="va">fit_default_var</span>, Constrained <span class="op">=</span> <span class="va">fit_constrained_var</span><span class="op">)</span>,</span>
<span>    parameter <span class="op">=</span> <span class="st">"sigma"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="05_custom_priors_files/figure-html/variance_prior-1.png" class="r-plt" width="700"></p>
</div>
<div class="section level2">
<h2 id="default-priors-reference">Default Priors Reference<a class="anchor" aria-label="anchor" href="#default-priors-reference"></a>
</h2>
<p>It is important to know what you are overriding. <code>because</code>
aims to use <strong>weakly informative</strong> defaults that provide
minimal regularization while allowing the data to dominate the
posterior.</p>
<table class="table">
<colgroup>
<col width="25%">
<col width="25%">
<col width="25%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th align="left">Parameter Type</th>
<th align="left">Parameter Name</th>
<th align="left">Default Prior</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><strong>Intercepts</strong></td>
<td align="left"><code>alpha_*</code></td>
<td align="left"><code>dnorm(0, 1.0E-6)</code></td>
<td align="left">Wide Normal (Precision 1e-6 = Variance 1,000,000)</td>
</tr>
<tr class="even">
<td align="left"><strong>Coefficients</strong></td>
<td align="left"><code>beta_*</code></td>
<td align="left"><code>dnorm(0, 1.0E-6)</code></td>
<td align="left">Wide Normal</td>
</tr>
<tr class="odd">
<td align="left"><strong>Precision</strong></td>
<td align="left"><code>tau_*</code></td>
<td align="left"><code>dgamma(1, 1)</code></td>
<td align="left">Gamma(1,1). Weakly informative for precision/variance
components.</td>
</tr>
<tr class="even">
<td align="left"><strong>Phylo Signal</strong></td>
<td align="left"><code>lambda_*</code></td>
<td align="left"><code>dunif(0, 1)</code></td>
<td align="left">Uniform on [0,1]</td>
</tr>
<tr class="odd">
<td align="left"><strong>Zero-Inflation</strong></td>
<td align="left"><code>psi_*</code></td>
<td align="left"><code>dbeta(1, 1)</code></td>
<td align="left">Beta(1,1) (Uniform on [0,1])</td>
</tr>
<tr class="even">
<td align="left"><strong>Ordinal Cutpoints</strong></td>
<td align="left"><code>cutpoint_*</code></td>
<td align="left"><code>dnorm(0, 1e-6)</code></td>
<td align="left">First cutpoint fixed, others relative or specifically
ordered</td>
</tr>
<tr class="odd">
<td align="left"><strong>NegBinomial Size</strong></td>
<td align="left"><code>r_*</code></td>
<td align="left"><code>dgamma(0.01, 0.01)</code></td>
<td align="left">Wide Gamma for dispersion parameter</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Precision vs Variance</strong>: JAGS uses precision
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>τ</mi><mo>=</mo><mn>1</mn><mi>/</mi><msup><mi>σ</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\tau = 1/\sigma^2</annotation></semantics></math>.
A prior of <code>dnorm(0, 1.0E-6)</code> means a normal distribution
with mean 0 and precision
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.000001</mn><annotation encoding="application/x-tex">0.000001</annotation></semantics></math>,
which corresponds to a variance of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>,</mo><mn>000</mn><mo>,</mo><mn>000</mn></mrow><annotation encoding="application/x-tex">1,000,000</annotation></semantics></math>
(SD = 1000). This is very flat.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="parameter-names-reference">Parameter Names Reference<a class="anchor" aria-label="anchor" href="#parameter-names-reference"></a>
</h2>
<p>To use custom priors, you need to know the exact internal name of the
parameter in the JAGS code.</p>
<p>Common patterns:</p>
<ul>
<li>
<code>alpha_{Response}</code>: Intercept</li>
<li>
<code>beta_{Response}_{Predictor}</code>: Regression
coefficient</li>
<li>
<code>tau_e_{Response}</code>: Residual precision</li>
<li>
<code>sigma_{Response}</code>: Residual standard deviation (derived,
usually not set directly as prior, set <code>tau</code> instead)</li>
<li>
<code>lambda_{Response}</code>: Phylogenetic signal (0-1)</li>
<li>
<code>psi_{Response}</code>: Zero-inflation probability</li>
</ul>
<p>If you are unsure, run a quick model with
<code>n.adapt=0, n.iter=0</code> (just compilation) and check the
generated model code:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_check</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/because.html">because</a></span><span class="op">(</span></span>
<span>    equations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Growth_g_day</span> <span class="op">~</span> <span class="va">Temp_Centered</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">df</span>,</span>
<span>    n.iter <span class="op">=</span> <span class="fl">0</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the JAGS model</span></span>
<span><span class="va">fit_check</span><span class="op">$</span><span class="va">model</span></span>
<span><span class="co">#&gt; JAGS model:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; model {</span></span>
<span><span class="co">#&gt;   # Dummy usage of ID to prevent warnings for unused data</span></span>
<span><span class="co">#&gt;   dummy_ID &lt;- ID[1,1]</span></span>
<span><span class="co">#&gt;   # Structural equations</span></span>
<span><span class="co">#&gt;   for (i in 1:N) {</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     muGrowth_g_day[i] &lt;- alphaGrowth_g_day + beta_Growth_g_day_Temp_Centered*Temp_Centered[i]</span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt;   # Multivariate normal likelihoods</span></span>
<span><span class="co">#&gt;   for (i in 1:N) {</span></span>
<span><span class="co">#&gt;     Growth_g_day[i] ~ dnorm(muGrowth_g_day[i], tau_e_Growth_g_day)</span></span>
<span><span class="co">#&gt;     log_lik_Growth_g_day[i] &lt;- logdensity.norm(Growth_g_day[i], muGrowth_g_day[i], tau_e_Growth_g_day)</span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt;   # Priors for structural parameters</span></span>
<span><span class="co">#&gt;   alphaGrowth_g_day ~ dnorm(0, 1.0E-6)</span></span>
<span><span class="co">#&gt;   tau_e_Growth_g_day ~ dgamma(1, 1)</span></span>
<span><span class="co">#&gt;   sigmaGrowth_g_day &lt;- 1/sqrt(tau_e_Growth_g_day)</span></span>
<span><span class="co">#&gt;   beta_Growth_g_day_Temp_Centered ~ dnorm(0, 1.0E-6)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; Fully observed variables:</span></span>
<span><span class="co">#&gt;  Growth_g_day ID N Temp_Centered dummy_ID</span></span></code></pre></div>
<p>```</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Achaz von Hardenberg.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
