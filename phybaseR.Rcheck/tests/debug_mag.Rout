
R version 4.5.2 (2025-10-31) -- "[Not] Part in a Rumble"
Copyright (C) 2025 The R Foundation for Statistical Computing
Platform: aarch64-apple-darwin20

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(phybaseR)
> library(ape)
> 
> # Reproduce MAG bug
> set.seed(123)
> N <- 35
> tree <- rtree(N)
> 
> df <- data.frame(
+     SP = tree$tip.label,
+     Y1 = rnorm(N, mean = 10, sd = 2),
+     Y2 = rnorm(N, mean = 8, sd = 1.5)
+ )
> 
> cat("Testing MAG model with latent variable...\n")
Testing MAG model with latent variable...
> fit <- phybase_run(
+     data = df,
+     structure = tree,
+     id_col = "SP",
+     latent = "L1",
+     equations = list(
+         Y1 ~ L1,
+         Y2 ~ L1
+     ),
+     latent_method = "correlations",
+     WAIC = TRUE,
+     n.chains = 2,
+     n.iter = 500,
+     quiet = FALSE
+ )
Converted data.frame to list with 2 variables: Y1, Y2
Standardizing tree (max_bt: 1.28 -> 1.0)
Using MAG approach: marginalized latent variables from structural equations.
Estimating 1 induced correlation(s) from latent variable(s)
Monitoring 2 pointwise log-likelihood parameter(s) for WAIC
Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 70
   Unobserved stochastic nodes: 44
   Total graph size: 2871

Initializing model

Warning messages:
1: In rjags::jags.model(model_file, data = data, n.chains = n.chains,  :
  Unused variable "zeros" in data
2: In phybase_waic(result) :
  Only 80 MCMC samples available. Standard errors may be unreliable. Consider using more iterations.
> 
> cat("\nSuccess!\n")

Success!
> 
> proc.time()
   user  system elapsed 
  3.617   0.143   4.074 
