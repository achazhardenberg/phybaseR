
R version 4.5.2 (2025-10-31) -- "[Not] Part in a Rumble"
Copyright (C) 2025 The R Foundation for Statistical Computing
Platform: aarch64-apple-darwin20

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(phybaseR)
> 
> # Reproduce Poisson bug
> set.seed(123)
> N <- 35
> df <- data.frame(
+     SP = paste0("sp", 1:N),
+     Y = rpois(N, lambda = 5),
+     X = rnorm(N)
+ )
> 
> cat("Testing Poisson model...\n")
Testing Poisson model...
> fit <- phybase_run(
+     data = df,
+     id_col = "SP",
+     equations = list(Y ~ X),
+     distribution = list(Y = "poisson"),
+     WAIC = TRUE,
+     n.chains = 2,
+     n.iter = 500,
+     quiet = FALSE
+ )
No structure/tree provided. Running standard (non-phylogenetic) SEM.
No tree provided. Running standard (non-phylogenetic) SEM.
Converted data.frame to list with 2 variables: Y, X
Monitoring 1 pointwise log-likelihood parameter(s) for WAIC
Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 35
   Unobserved stochastic nodes: 38
   Total graph size: 1477

Initializing model

Warning messages:
1: In rjags::jags.model(model_file, data = data, n.chains = n.chains,  :
  Unused variable "ID2" in data
2: In phybase_waic(result) :
  Only 80 MCMC samples available. Standard errors may be unreliable. Consider using more iterations.
> 
> cat("\nModel code:\n")

Model code:
> cat(fit$model_code)
model {
  # Dummy usage of ID to prevent warnings in GLMM-only models
  dummy_ID <- ID[1,1]
  # Structural equations
  for (i in 1:N) {
    # Poisson log link for Y
    log(mu_Y[i]) <- alphaY + beta_Y_X*X[i] + err_Y[i]
    Y[i] ~ dpois(mu_Y[i])
    log_lik_Y[i] <- logdensity.pois(Y[i], mu_Y[i])
  }
  # Multivariate normal likelihoods
  # Independent residual error for Poisson: Y
  for (i in 1:N) {
    epsilon_Y[i] ~ dnorm(0, tau_e_Y)
    err_Y[i] <- epsilon_Y[i]
  }
  # Priors for structural parameters
  # Priors for Y (Poisson)
  tau_e_Y ~ dgamma(1, 1)
  alphaY ~ dnorm(0, 1.0E-6)
  beta_Y_X ~ dnorm(0, 1.0E-6)
  # Covariance structure for responses
  # Predictor priors for imputation
}> 
> proc.time()
   user  system elapsed 
  0.397   0.035   0.473 
