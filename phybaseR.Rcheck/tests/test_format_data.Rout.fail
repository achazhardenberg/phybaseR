
R version 4.5.2 (2025-10-31) -- "[Not] Part in a Rumble"
Copyright (C) 2025 The R Foundation for Statistical Computing
Platform: aarch64-apple-darwin20

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(phybaseR)
> 
> # Create example data matching user's format with different numbers of replicates
> set.seed(123)
> data_long <- data.frame(
+     SP = c(rep("s1", 10), rep("s2", 7), rep("s3", 5)), # Different reps per species!
+     BM = rnorm(22, mean = 0, sd = 1),
+     NL = rnorm(22, mean = 0, sd = 1)
+ )
> 
> # Add some missing values
> data_long$BM[c(5, 15)] <- NA
> data_long$NL[c(8, 18)] <- NA
> 
> cat("\n=== Original Data ===\n")

=== Original Data ===
> cat("Species counts:\n")
Species counts:
> print(table(data_long$SP))

s1 s2 s3 
10  7  5 
> print(head(data_long, 12))
   SP          BM         NL
1  s1 -0.56047565 -1.0260044
2  s1 -0.23017749 -0.7288912
3  s1  1.55870831 -0.6250393
4  s1  0.07050839 -1.6866933
5  s1          NA  0.8377870
6  s1  1.71506499  0.1533731
7  s1  0.46091621 -1.1381369
8  s1 -1.26506123         NA
9  s1 -0.68685285  0.4264642
10 s1 -0.44566197 -0.2950715
11 s2  1.22408180  0.8951257
12 s2  0.35981383  0.8781335
> 
> # Create a simple tree
> tree <- ape::read.tree(text = "(s1:1,s2:1,s3:1);")
> 
> cat("\n\n=== Testing phybase_format_data ===\n")


=== Testing phybase_format_data ===
> data_list <- phybase_format_data(data_long, species_col = "SP", tree = tree)
> 
> cat("\nFormatted data structure:\n")

Formatted data structure:
> str(data_list)
List of 2
 $ BM: num [1:3, 1:10] -0.56 1.22 -1.97 -0.23 0.36 ...
  ..- attr(*, "dimnames")=List of 2
  .. ..$ : chr [1:3] "s1" "s2" "s3"
  .. ..$ : NULL
 $ NL: num [1:3, 1:10] -1.026 0.895 NA -0.729 0.878 ...
  ..- attr(*, "dimnames")=List of 2
  .. ..$ : chr [1:3] "s1" "s2" "s3"
  .. ..$ : NULL
> 
> cat("\n\n=== BM Matrix ===\n")


=== BM Matrix ===
> print(data_list$BM)
         [,1]       [,2]       [,3]        [,4]       [,5]     [,6]      [,7]
s1 -0.5604756 -0.2301775  1.5587083  0.07050839         NA 1.715065 0.4609162
s2  1.2240818  0.3598138  0.4007715  0.11068272         NA 1.786913 0.4978505
s3 -1.9666172  0.7013559 -0.4727914 -1.06782371 -0.2179749       NA        NA
        [,8]       [,9]     [,10]
s1 -1.265061 -0.6868529 -0.445662
s2        NA         NA        NA
s3        NA         NA        NA
> 
> cat("\n\n=== NL Matrix ===\n")


=== NL Matrix ===
> print(data_list$NL)
         [,1]       [,2]       [,3]       [,4]      [,5]        [,6]       [,7]
s1 -1.0260044 -0.7288912 -0.6250393 -1.6866933 0.8377870  0.15337312 -1.1381369
s2  0.8951257  0.8781335  0.8215811  0.6886403 0.5539177 -0.06191171 -0.3059627
s3         NA -0.6947070 -0.2079173 -1.2653964 2.1689560          NA         NA
   [,8]      [,9]      [,10]
s1   NA 0.4264642 -0.2950715
s2   NA        NA         NA
s3   NA        NA         NA
> 
> cat("\n\n=== Testing with phybase_run ===\n")


=== Testing with phybase_run ===
> fit <- phybase_run(
+     data = data_list,
+     tree = tree,
+     equations = list(NL ~ BM),
+     n.iter = 1000,
+     n.burnin = 500,
+     quiet = TRUE
+ )
Error in phybase_run(data = data_list, tree = tree, equations = list(NL ~  : 
  Variable NL specified as 'reps' type but column NL_obs (as matrix) not found in data.
Execution halted
