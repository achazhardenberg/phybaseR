
R version 4.5.2 (2025-10-31) -- "[Not] Part in a Rumble"
Copyright (C) 2025 The R Foundation for Statistical Computing
Platform: aarch64-apple-darwin20

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(phybaseR)
> library(ape)
> 
> # Test with phylogenetic structure
> set.seed(123)
> N <- 10
> tree <- rtree(N)
> 
> df <- data.frame(
+     SP = tree$tip.label,
+     Y = rnorm(N, mean = 10, sd = 2),
+     X = rnorm(N)
+ )
> 
> cat("=== Test 1: Phylogenetic SEM with optimise=TRUE ===\n")
=== Test 1: Phylogenetic SEM with optimise=TRUE ===
> fit1 <- phybase_run(
+     data = df,
+     structure = tree,
+     id_col = "SP",
+     equations = list(Y ~ X),
+     optimise = TRUE,
+     n.chains = 1,
+     n.iter = 100,
+     quiet = FALSE
+ )
Converted data.frame to list with 2 variables: Y, X
Standardizing tree (max_bt: 2.41 -> 1.0)
Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 10
   Unobserved stochastic nodes: 5
   Total graph size: 307

Initializing model

NOTE: Stopping adaptation


Warning messages:
1: In rjags::jags.model(model_file, data = data, n.chains = n.chains,  :
  Unused variable "ID2" in data
2: In rjags::jags.model(model_file, data = data, n.chains = n.chains,  :
  Adaptation incomplete
3: In phybase_run(data = df, structure = tree, id_col = "SP", equations = list(Y ~  :
  DIC and WAIC require at least 2 chains. Disabling calculation.
> 
> if (grepl("log_lik_Y", fit1$model_code)) {
+     cat("✓ PASS: log_lik found in optimized model\n")
+ } else {
+     cat("✗ FAIL: log_lik NOT found in optimized model\n")
+ }
✓ PASS: log_lik found in optimized model
> 
> cat("\n=== Test 2: Phylogenetic SEM with optimise=FALSE (MVN) ===\n")

=== Test 2: Phylogenetic SEM with optimise=FALSE (MVN) ===
> fit2 <- phybase_run(
+     data = df,
+     structure = tree,
+     id_col = "SP",
+     equations = list(Y ~ X),
+     optimise = FALSE,
+     n.chains = 1,
+     n.iter = 100,
+     quiet = FALSE
+ )
Converted data.frame to list with 2 variables: Y, X
Standardizing tree (max_bt: 2.41 -> 1.0)
Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 1
   Unobserved stochastic nodes: 4
   Total graph size: 280

Initializing model

NOTE: Stopping adaptation


Warning messages:
1: In rjags::jags.model(model_file, data = data, n.chains = n.chains,  :
  Unused variable "Prec_phylo" in data
2: In rjags::jags.model(model_file, data = data, n.chains = n.chains,  :
  Unused variable "zeros" in data
3: In rjags::jags.model(model_file, data = data, n.chains = n.chains,  :
  Unused variable "ID2" in data
4: In rjags::jags.model(model_file, data = data, n.chains = n.chains,  :
  Adaptation incomplete
5: In phybase_run(data = df, structure = tree, id_col = "SP", equations = list(Y ~  :
  DIC and WAIC require at least 2 chains. Disabling calculation.
> 
> if (grepl("log_lik_Y", fit2$model_code)) {
+     cat("✓ PASS: log_lik found in MVN model\n")
+ 
+     # Check for tau_marg
+     if (grepl("tau_marg", fit2$model_code)) {
+         cat(
+             "✓ PASS: tau_marg extraction found (diagonal of precision matrix)\n"
+         )
+     }
+ } else {
+     cat("✗ FAIL: log_lik NOT found in MVN model\n")
+ }
✓ PASS: log_lik found in MVN model
✓ PASS: tau_marg extraction found (diagonal of precision matrix)
> 
> cat("\n=== Summary ===\n")

=== Summary ===
> cat("Both phylogenetic cases now have log_lik monitoring!\n")
Both phylogenetic cases now have log_lik monitoring!
> 
> proc.time()
   user  system elapsed 
  0.351   0.042   0.416 
