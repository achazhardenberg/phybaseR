
R version 4.5.2 (2025-10-31) -- "[Not] Part in a Rumble"
Copyright (C) 2025 The R Foundation for Statistical Computing
Platform: aarch64-apple-darwin20

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(phybaseR)
> library(ape)
> 
> set.seed(123)
> N <- 30
> tree <- rtree(N)
> 
> # Simulate data with latent variable L affecting X and Y
> L_true <- rnorm(N)
> X <- 0.8 * L_true + rnorm(N, sd = 0.3)
> Y <- 0.6 * L_true + rnorm(N, sd = 0.4)
> 
> data_list <- list(
+     X = X,
+     Y = Y
+ )
> 
> equations <- list(
+     X ~ L,
+     Y ~ L
+ )
> 
> cat("=== Testing Latent Variable Methods ===\n\n")
=== Testing Latent Variable Methods ===

> 
> # Test 1: MAG Approach (correlations) - DEFAULT
> cat("Test 1: MAG Approach (default, correlations)\n")
Test 1: MAG Approach (default, correlations)
> cat(paste(rep("-", 40), collapse = ""), "\n")
---------------------------------------- 
> 
> fit_mag <- phybase_run(
+     data = data_list,
+     tree = tree,
+     equations = equations,
+     latent = "L",
+     latent_method = "correlations", # Or omit for default
+     n.iter = 2000,
+     n.burnin = 1000,
+     quiet = FALSE
+ )
Standardizing tree (max_bt: 1.44 -> 1.0)
Using MAG approach: marginalized latent variables from structural equations.
Estimating 1 induced correlation(s) from latent variable(s)
Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 60
   Unobserved stochastic nodes: 39
   Total graph size: 2166

Initializing model

Warning message:
In rjags::jags.model(model_file, data = data, n.chains = n.chains,  :
  Unused variable "zeros" in data
> 
> cat("\nParameters monitored (MAG):\n")

Parameters monitored (MAG):
> print(names(fit_mag$samples[[1]][1, ]))
[1] "rho_X_Y"       "sigma_obs_X"   "sigma_obs_Y"   "sigma_res_X_Y"
[5] "sigma_res_Y_X"
> 
> cat("\nSummary (should show rho_X_Y):\n")

Summary (should show rho_X_Y):
> print(summary(fit_mag))
               Mean    SD Naive SE Time-series SE   2.5%   50% 97.5%  Rhat
rho_X_Y       0.381 0.273    0.016          0.016 -0.235 0.417 0.782 1.000
sigma_obs_X   0.552 0.115    0.007          0.007  0.365 0.541 0.799 1.003
sigma_obs_Y   0.535 0.106    0.006          0.005  0.376 0.518 0.782 1.011
sigma_res_X_Y 0.499 0.119    0.007          0.007  0.310 0.483 0.762 1.006
sigma_res_Y_X 0.499 0.113    0.007          0.007  0.309 0.485 0.729 1.005
              n.eff
rho_X_Y         300
sigma_obs_X     265
sigma_obs_Y     618
sigma_res_X_Y   300
sigma_res_Y_X   258

DIC:
Mean deviance:  84.35 
penalty 46.14 
Penalized deviance: 130.5 
               Mean    SD Naive SE Time-series SE   2.5%   50% 97.5%  Rhat
rho_X_Y       0.381 0.273    0.016          0.016 -0.235 0.417 0.782 1.000
sigma_obs_X   0.552 0.115    0.007          0.007  0.365 0.541 0.799 1.003
sigma_obs_Y   0.535 0.106    0.006          0.005  0.376 0.518 0.782 1.011
sigma_res_X_Y 0.499 0.119    0.007          0.007  0.310 0.483 0.762 1.006
sigma_res_Y_X 0.499 0.113    0.007          0.007  0.309 0.485 0.729 1.005
              n.eff
rho_X_Y         300
sigma_obs_X     265
sigma_obs_Y     618
sigma_res_X_Y   300
sigma_res_Y_X   258
> 
> cat("\nInduced correlations:\n")

Induced correlations:
> print(fit_mag$induced_correlations)
[[1]]
[1] "X" "Y"

> 
> cat("\n\n")


> 
> # Test 2: Explicit Latent Variables
> cat("Test 2: Explicit Latent Variable Modeling\n")
Test 2: Explicit Latent Variable Modeling
> cat(paste(rep("-", 40), collapse = ""), "\n")
---------------------------------------- 
> 
> fit_explicit <- phybase_run(
+     data = data_list,
+     tree = tree,
+     equations = equations,
+     latent = "L",
+     latent_method = "explicit",
+     n.iter = 2000,
+     n.burnin = 1000,
+     quiet = FALSE
+ )
Standardizing tree (max_bt: 1.44 -> 1.0)
Using explicit latent variable modeling
Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 60
   Unobserved stochastic nodes: 40
   Total graph size: 2308

Initializing model

Warning message:
In rjags::jags.model(model_file, data = data, n.chains = n.chains,  :
  Unused variable "ID2" in data
> 
> cat("\nParameters monitored (Explicit):\n")

Parameters monitored (Explicit):
> print(names(fit_explicit$samples[[1]][1, ]))
[1] "alphaX"   "alphaY"   "beta_X_L" "beta_Y_L" "lambdaX"  "lambdaY"  "sigmaX"  
[8] "sigmaY"  
> 
> cat("\nSummary (should show beta_X_L, beta_Y_L):\n")

Summary (should show beta_X_L, beta_Y_L):
> print(summary(fit_explicit))
           Mean    SD Naive SE Time-series SE   2.5%    50% 97.5%  Rhat n.eff
alphaX   -0.009 0.360    0.021          0.039 -0.766 -0.017 0.679 1.020   120
alphaY    0.123 0.344    0.020          0.030 -0.512  0.126 0.830 1.002   151
beta_X_L  0.053 0.437    0.025          0.083 -0.648  0.186 0.738 1.071    25
beta_Y_L  0.039 0.435    0.025          0.081 -0.689  0.142 0.686 1.079    30
lambdaX   0.489 0.131    0.008          0.009  0.249  0.489 0.729 0.997   238
lambdaY   0.478 0.123    0.007          0.007  0.246  0.476 0.728 1.011   264
sigmaX    0.772 0.118    0.007          0.007  0.592  0.756 1.035 0.999   300
sigmaY    0.746 0.113    0.007          0.007  0.563  0.739 0.985 1.001   300

DIC:
Mean deviance:  82.24 
penalty 42.63 
Penalized deviance: 124.9 
           Mean    SD Naive SE Time-series SE   2.5%    50% 97.5%  Rhat n.eff
alphaX   -0.009 0.360    0.021          0.039 -0.766 -0.017 0.679 1.020   120
alphaY    0.123 0.344    0.020          0.030 -0.512  0.126 0.830 1.002   151
beta_X_L  0.053 0.437    0.025          0.083 -0.648  0.186 0.738 1.071    25
beta_Y_L  0.039 0.435    0.025          0.081 -0.689  0.142 0.686 1.079    30
lambdaX   0.489 0.131    0.008          0.009  0.249  0.489 0.729 0.997   238
lambdaY   0.478 0.123    0.007          0.007  0.246  0.476 0.728 1.011   264
sigmaX    0.772 0.118    0.007          0.007  0.592  0.756 1.035 0.999   300
sigmaY    0.746 0.113    0.007          0.007  0.563  0.739 0.985 1.001   300
> 
> cat("\n✓ Both methods completed successfully!\n")

✓ Both methods completed successfully!
> 
> proc.time()
   user  system elapsed 
 13.659   0.188  14.111 
