
R version 4.5.2 (2025-10-31) -- "[Not] Part in a Rumble"
Copyright (C) 2025 The R Foundation for Statistical Computing
Platform: aarch64-apple-darwin20

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(phybaseR)
> library(ape)
> 
> # Simulate data
> set.seed(123)
> N <- 50
> tree <- rtree(N)
> data <- data.frame(
+     X = rnorm(N),
+     Y = rnorm(N)
+ )
> data$Y <- 0.5 * data$X + rnorm(N)
> 
> 
> # Generate model code directly to inspect it
> model_out <- phybaseR:::phybase_model(
+     equations = list(Y ~ X),
+     multi.tree = FALSE,
+     distribution = NULL,
+     variability = NULL,
+     vars_with_na = NULL,
+     induced_correlations = NULL
+ )
> 
> cat("--- Generated JAGS Model ---\n")
--- Generated JAGS Model ---
> cat(model_out$model)
model {
  # Dummy usage of ID to prevent warnings in GLMM-only models
  dummy_ID <- ID[1,1]
  # Structural equations
  for (i in 1:N) {
    muY[i] <- alphaY + beta_Y_X*X[i]
  }
  # Multivariate normal likelihoods
  for (i in 1:N) {
    Y[i] ~ dnorm(muY[i], tau_e_Y)
    log_lik_Y[i] <- logdensity.norm(Y[i], muY[i], tau_e_Y)
  }
  # Priors for structural parameters
  alphaY ~ dnorm(0, 1.0E-6)
  tau_e_Y ~ dgamma(1, 1)
  sigmaY <- 1/sqrt(tau_e_Y)
  beta_Y_X ~ dnorm(0, 1.0E-6)
  # Covariance structure for responses
  # Predictor priors for imputation
}> cat("\n--------------------------\n")

--------------------------
> 
> # Run model with 2 chains to enable Rhat calculation
> fit <- phybase_run(
+     data = data,
+     tree = tree,
+     equations = list(Y ~ X),
+     n.chains = 2,
+     n.iter = 1000,
+     n.burnin = 500,
+     quiet = TRUE
+ )
Warning message:
In rjags::jags.model(model_file, data = data, n.chains = n.chains,  :
  Unused variable "ID2" in data
> 
> # Capture summary output
> cat("--- Summary Output ---\n")
--- Summary Output ---
> summ <- summary(fit)
          Mean    SD Naive SE Time-series SE   2.5%   50% 97.5%  Rhat n.eff
alphaY   0.046 0.406    0.041          0.050 -0.644 0.005 0.939 0.991    76
beta_Y_X 0.365 0.165    0.017          0.017  0.035 0.366 0.661 0.993   100
lambdaY  0.300 0.129    0.013          0.011  0.115 0.271 0.610 1.053   160
sigmaY   1.314 0.135    0.014          0.014  1.078 1.308 1.580 0.993   100

DIC:
Mean deviance:  149.8 
penalty 12.79 
Penalized deviance: 162.6 
> 
> # Check if Rhat and n.eff are present in the output object (if invisible) or printed
> # Since summary prints, we can also inspect the returned object if I modified it to return the combined table
> # In my modification:
> # For standard summary, I return `invisible(combined)` where combined has Rhat and n.eff columns.
> 
> if ("Rhat" %in% colnames(summ)) {
+     cat("\n[PASS] Rhat column found in summary object.\n")
+     print(head(summ[, c("Rhat", "n.eff")]))
+ } else {
+     cat("\n[FAIL] Rhat column NOT found in summary object.\n")
+ }

[PASS] Rhat column found in summary object.
          Rhat n.eff
alphaY   0.991    76
beta_Y_X 0.993   100
lambdaY  1.053   160
sigmaY   0.993   100
> 
> if ("n.eff" %in% colnames(summ)) {
+     cat("\n[PASS] n.eff column found in summary object.\n")
+ } else {
+     cat("\n[FAIL] n.eff column NOT found in summary object.\n")
+ }

[PASS] n.eff column found in summary object.
> 
> proc.time()
   user  system elapsed 
  2.296   0.092   2.487 
