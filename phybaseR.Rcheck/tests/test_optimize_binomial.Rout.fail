
R version 4.5.2 (2025-10-31) -- "[Not] Part in a Rumble"
Copyright (C) 2025 The R Foundation for Statistical Computing
Platform: aarch64-apple-darwin20

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> # ==============================================================================
> # Test Script: JAGS Optimization for Binomial Distribution
> # ==============================================================================
> # Verifies that the optimized random effects formulation works correctly
> # for binomial (binary) response variables.
> # ==============================================================================
> 
> # library(phybaseR)
> library(ape)
> library(coda)
> library(rjags)
Linked to JAGS 4.3.2
Loaded modules: basemod,bugs
> 
> # Source local files
> 
> cat("\n=== Testing JAGS Optimization (Binomial Model) ===\n\n")

=== Testing JAGS Optimization (Binomial Model) ===

> 
> # 1. Simulate Data
> set.seed(456)
> N <- 50
> tree <- rtree(N)
> tree$edge.length <- tree$edge.length / max(branching.times(tree))
> VCV <- vcv.phylo(tree)
> 
> # True parameters
> beta <- 1.0 # Effect of X on logit(p)
> lambda <- 0.6 # Phylogenetic signal
> sigma_total <- 1.5 # Total variance on logit scale
> 
> # Calculate variance components
> # lambda = phylo_var / (phylo_var + resid_var)
> # total_var = phylo_var + resid_var
> phylo_var <- lambda * sigma_total^2
> resid_var <- (1 - lambda) * sigma_total^2
> 
> # Simulate X (predictor)
> X <- rnorm(N)
> 
> # Simulate phylogenetic + residual error on logit scale
> Sigma_phylo <- phylo_var * VCV
> err_phylo <- MASS::mvrnorm(1, rep(0, N), Sigma_phylo)
> err_resid <- rnorm(N, 0, sqrt(resid_var))
> err_total <- err_phylo + err_resid
> 
> # Calculate probability and simulate binary outcomes
> logit_p <- beta * X + err_total
> p <- plogis(logit_p)
> Y <- rbinom(N, 1, p)
> 
> cat(sprintf(
+     "Simulated data: %d binary observations (%.1f%% ones)\n",
+     N,
+     100 * mean(Y)
+ ))
Simulated data: 50 binary observations (26.0% ones)
> 
> data <- list(Y = Y, X = X)
> equations <- list(Y ~ X)
> 
> # 2. Run Optimized Model
> cat("\nRunning optimized model (optimize = TRUE)...\n")

Running optimized model (optimize = TRUE)...
> time_opt <- system.time({
+     fit_opt <- phybase_run(
+         data = data,
+         tree = tree,
+         equations = equations,
+         distribution = c(Y = "binomial"),
+         n.iter = 3000,
+         n.burnin = 500,
+         n.thin = 3,
+         optimise = TRUE,
+         quiet = TRUE
+     )
+ })
Error in phybase_run(data = data, tree = tree, equations = equations,  : 
  could not find function "phybase_run"
Calls: system.time
Timing stopped at: 0 0 0
Execution halted
