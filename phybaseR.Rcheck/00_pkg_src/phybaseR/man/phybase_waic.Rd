% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/phybase_waic.R
\name{phybase_waic}
\alias{phybase_waic}
\title{Calculate WAIC with Standard Errors for a PhyBaSE Model}
\usage{
phybase_waic(model)
}
\arguments{
\item{model}{A fitted model object of class \code{"phybase"} returned by \code{\link{phybase_run}}
with \code{WAIC = TRUE}.}
}
\value{
A data frame with columns \code{Estimate} and \code{SE} containing:
\item{elpd_waic}{Expected log pointwise predictive density (higher is better)}
\item{p_waic}{Effective number of parameters}
\item{waic}{The WAIC value (lower is better for model comparison)}

The returned object also has a \code{pointwise} attribute containing individual
observation contributions for model comparison.
}
\description{
Calculates the Widely Applicable Information Criterion (WAIC) with standard errors
for a fitted PhyBaSE model using pointwise log-likelihoods.
}
\details{
This function implements WAIC following Vehtari et al. (2017). It requires that
the model was run with \code{WAIC = TRUE} to monitor pointwise log-likelihoods.
}
\section{WAIC Definition}{

The Widely Applicable Information Criterion (WAIC) is calculated as:
\deqn{WAIC = -2 \times (lppd - p_{waic})}
where:
\itemize{
  \item \eqn{lppd = \sum_{i=1}^N \log(\frac{1}{S} \sum_{s=1}^S \exp(log\_lik_{is}))} is the log pointwise predictive density
  \item \eqn{p_{waic} = \sum_{i=1}^N \text{var}(log\_lik_{is})} is the effective number of parameters
}

**WAIC Algorithm**:
\enumerate{
  \item \strong{lpd} (log pointwise predictive density): For each observation \eqn{i},
    compute \eqn{\log(\text{mean}(\exp(\text{log\_lik}_i)))} across MCMC samples
  \item \strong{p_waic}: For each observation \eqn{i}, compute
    \eqn{\text{var}(\text{log\_lik}_i)} across MCMC samples
  \item \strong{elpd_waic}: \eqn{\text{lpd}_i - \text{p\_waic}_i} for each observation
  \item \strong{waic}: \eqn{-2 \times \sum \text{elpd\_waic}_i}
}
}

\section{Standard Errors}{

Standard errors for WAIC are calculated using the pointwise contributions:
\deqn{SE(WAIC) = \sqrt{N \times \text{var}(waic_i)}}
where \eqn{waic_i = -2 \times (lppd_i - p_{waic,i})}.
}

\examples{
\dontrun{
  # Fit model with WAIC monitoring
  fit <- phybase_run(data, tree, equations, WAIC = TRUE)

  # View WAIC with standard errors
  fit$WAIC
  #             Estimate   SE
  # elpd_waic   -617.3   12.4
  # p_waic        12.3    3.1
  # waic        1234.5   24.8

  # Compare two models
  fit1$WAIC
  fit2$WAIC
  # Model with lower WAIC is preferred
  # Difference is significant if |WAIC1 - WAIC2| > 2 * sqrt(SE1^2 + SE2^2)
}

}
\references{
Vehtari, A., Gelman, A., & Gabry, J. (2017). Practical Bayesian model
evaluation using leave-one-out cross-validation and WAIC.
\emph{Statistics and Computing}, 27(5), 1413-1432.
}
