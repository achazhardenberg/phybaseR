<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Generate a JAGS model string for Phylogenetic Bayesian SEM (Because) — because_model • because</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate a JAGS model string for Phylogenetic Bayesian SEM (Because) — because_model"><meta name="description" content="This function builds the model code to be passed to JAGS based on a set of structural equations.
It supports both single and multiple phylogenetic trees (to account for phylogenetic uncertainty).
Missing values are handled both in the response and predictor variables treating all of them as stochastic nodes."><meta property="og:description" content="This function builds the model code to be passed to JAGS based on a set of structural equations.
It supports both single and multiple phylogenetic trees (to account for phylogenetic uncertainty).
Missing values are handled both in the response and predictor variables treating all of them as stochastic nodes."><meta property="og:image" content="https://because-pkg.github.io/because/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">because</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/01_getting_started.html">Getting Started with because</a></li>
    <li><a class="dropdown-item" href="../articles/02_dseparation.html">Causal inference with d-separation</a></li>
    <li><a class="dropdown-item" href="../articles/03_phylogenetic_models.html">Phylogenetic Models</a></li>
    <li><a class="dropdown-item" href="../articles/04_missing_data.html">Missing Data Imputation in because</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/because-pkg/because/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Generate a JAGS model string for Phylogenetic Bayesian SEM (Because)</h1>
      <small class="dont-index">Source: <a href="https://github.com/because-pkg/because/blob/master/R/because_model.R" class="external-link"><code>R/because_model.R</code></a></small>
      <div class="d-none name"><code>because_model.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function builds the model code to be passed to JAGS based on a set of structural equations.
It supports both single and multiple phylogenetic trees (to account for phylogenetic uncertainty).
Missing values are handled both in the response and predictor variables treating all of them as stochastic nodes.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">because_model</span><span class="op">(</span></span>
<span>  <span class="va">equations</span>,</span>
<span>  multi.tree <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  latent_method <span class="op">=</span> <span class="st">"correlations"</span>,</span>
<span>  structure_names <span class="op">=</span> <span class="st">"phylo"</span>,</span>
<span>  random_structure_names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  random_terms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  vars_with_na <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  induced_correlations <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  variability <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  distribution <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  optimise <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  standardize_latent <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  poly_terms <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  latent <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fix_residual_variance <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-equations">equations<a class="anchor" aria-label="anchor" href="#arg-equations"></a></dt>
<dd><p>A list of model formulas.</p></dd>


<dt id="arg-multi-tree">multi.tree<a class="anchor" aria-label="anchor" href="#arg-multi-tree"></a></dt>
<dd><p>Logical; if <code>TRUE</code>, incorporates phylogenetic uncertainty by sampling across a set of trees.</p></dd>


<dt id="arg-structure-names">structure_names<a class="anchor" aria-label="anchor" href="#arg-structure-names"></a></dt>
<dd><p>(Internal) Character vector of names for multiple trees/structures.</p></dd>


<dt id="arg-vars-with-na">vars_with_na<a class="anchor" aria-label="anchor" href="#arg-vars-with-na"></a></dt>
<dd><p>Optional character vector of response variable names that have missing data.
These variables will use element-wise likelihoods instead of multivariate normal.</p></dd>


<dt id="arg-induced-correlations">induced_correlations<a class="anchor" aria-label="anchor" href="#arg-induced-correlations"></a></dt>
<dd><p>Optional list of variable pairs with induced correlations
from latent variables. Each element should be a character vector of length 2 specifying
the pair of variables that share a latent common cause.</p></dd>


<dt id="arg-variability">variability<a class="anchor" aria-label="anchor" href="#arg-variability"></a></dt>
<dd><p>Optional character vector or named character vector of variable names that have measurement error or within-species variability.
If named, the names should be the variable names and the values should be the type of variability: "se" (for mean and standard error) or "reps" (for repeated measures).
If unnamed, it defaults to "se" for all specified variables.</p><ul><li><p>"se": Expects <code>Var_mean</code> and <code>Var_se</code> in the data. The model fixes observation error: <code>Var_mean ~ dnorm(Var, 1/Var_se^2)</code>.</p></li>
<li><p>"reps": Expects <code>Var_obs</code> (matrix) and <code>N_reps_Var</code> (vector) in the data. The model estimates observation error: <code>Var_obs[i,j] ~ dnorm(Var[i], Var_tau)</code>.</p></li>
</ul></dd>


<dt id="arg-distribution">distribution<a class="anchor" aria-label="anchor" href="#arg-distribution"></a></dt>
<dd><p>Optional named character vector specifying the distribution for response variables.
Default is "gaussian" for all variables. Supported values: "gaussian", "binomial", "multinomial".
For "binomial" variables, the model uses a logit link and a Bernoulli likelihood, with phylogenetic correlation modeled on the latent scale.</p></dd>


<dt id="arg-optimise">optimise<a class="anchor" aria-label="anchor" href="#arg-optimise"></a></dt>
<dd><p>Logical. If TRUE (default), use random effects formulation for 4.6× speedup.
If FALSE, use original marginal covariance formulation.</p></dd>


<dt id="arg-standardize-latent">standardize_latent<a class="anchor" aria-label="anchor" href="#arg-standardize-latent"></a></dt>
<dd><p>Logical (default TRUE). If TRUE, standardizes latent variables to unit variance.</p></dd>


<dt id="arg-poly-terms">poly_terms<a class="anchor" aria-label="anchor" href="#arg-poly-terms"></a></dt>
<dd><p>(Internal) List of polynomial terms for model generation.</p></dd>


<dt id="arg-latent">latent<a class="anchor" aria-label="anchor" href="#arg-latent"></a></dt>
<dd><p>Optional character vector of latent variable names.</p></dd>


<dt id="arg-fix-residual-variance">fix_residual_variance<a class="anchor" aria-label="anchor" href="#arg-fix-residual-variance"></a></dt>
<dd><p>Optional numeric value or named vector to fix residual variance.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with two elements:</p><ul><li><p><code>model</code>: A character string containing the JAGS model code.</p></li>
<li><p><code>parameter_map</code>: A data frame mapping response variables to their predictors and parameter names.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The generated model includes:</p><ul><li><p>Linear predictors and multivariate normal likelihoods for each response variable.</p></li>
<li><p>Priors for intercepts (<code>alpha</code>), slopes (<code>beta</code>), lambda parameters (<code>lambda</code>), and residual precisions (<code>tau</code>).</p></li>
<li><p>Phylogenetic covariance modeled via a single <code>VCV</code> matrix (when <code>multi.tree = FALSE</code>) or a 3D array <code>multiVCV[,,K]</code> with categorical sampling across trees (when <code>multi.tree = TRUE</code>).</p></li>
<li><p>(Optional) Observation models for variables with measurement error:</p><ul><li><p>Type "se": <code>Var_mean ~ dnorm(Var, 1/Var_se^2)</code></p></li>
<li><p>Type "reps": <code>Var_obs[i,j] ~ dnorm(Var[i], Var_tau)</code></p></li>
</ul></li>
<li><p>(Optional) Generalized linear mixed models for non-Gaussian responses (e.g., binomial).</p></li>
<li><p>(Optional) Element-wise likelihoods for response variables with missing data.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">eqs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">BR</span> <span class="op">~</span> <span class="va">BM</span>, <span class="va">S</span> <span class="op">~</span> <span class="va">BR</span>, <span class="va">G</span> <span class="op">~</span> <span class="va">BR</span>, <span class="va">L</span> <span class="op">~</span> <span class="va">BR</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu">because_model</span><span class="op">(</span><span class="va">eqs</span>, multi.tree <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> model {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   # Dummy usage of ID to prevent warnings for unused data</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   dummy_ID &lt;- ID[1,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   # Structural equations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   for (i in 1:N) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     muBR[i] &lt;- alphaBR + beta_BR_BM*BM[i]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     muS[i] &lt;- alphaS + beta_S_BR*BR[i]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     muG[i] &lt;- alphaG + beta_G_BR*BR[i]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     muL[i] &lt;- alphaL + beta_L_BR*BR[i]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   # Multivariate normal likelihoods</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   u_std_BR_phylo[1:N] ~ dmnorm(zeros[1:N], Prec_phylo[1:N, 1:N, K])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   for (i in 1:N) { u_BR_phylo[i] &lt;- u_std_BR_phylo[i] / sqrt(tau_u_BR_phylo) }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   for (i in 1:N) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     BR[i] ~ dnorm(muBR[i] + u_BR_phylo[i], tau_e_BR)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     log_lik_BR[i] &lt;- logdensity.norm(BR[i], muBR[i] + u_BR_phylo[i], tau_e_BR)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   u_std_S_phylo[1:N] ~ dmnorm(zeros[1:N], Prec_phylo[1:N, 1:N, K])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   for (i in 1:N) { u_S_phylo[i] &lt;- u_std_S_phylo[i] / sqrt(tau_u_S_phylo) }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   for (i in 1:N) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     S[i] ~ dnorm(muS[i] + u_S_phylo[i], tau_e_S)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     log_lik_S[i] &lt;- logdensity.norm(S[i], muS[i] + u_S_phylo[i], tau_e_S)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   u_std_G_phylo[1:N] ~ dmnorm(zeros[1:N], Prec_phylo[1:N, 1:N, K])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   for (i in 1:N) { u_G_phylo[i] &lt;- u_std_G_phylo[i] / sqrt(tau_u_G_phylo) }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   for (i in 1:N) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     G[i] ~ dnorm(muG[i] + u_G_phylo[i], tau_e_G)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     log_lik_G[i] &lt;- logdensity.norm(G[i], muG[i] + u_G_phylo[i], tau_e_G)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   u_std_L_phylo[1:N] ~ dmnorm(zeros[1:N], Prec_phylo[1:N, 1:N, K])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   for (i in 1:N) { u_L_phylo[i] &lt;- u_std_L_phylo[i] / sqrt(tau_u_L_phylo) }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   for (i in 1:N) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     L[i] ~ dnorm(muL[i] + u_L_phylo[i], tau_e_L)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     log_lik_L[i] &lt;- logdensity.norm(L[i], muL[i] + u_L_phylo[i], tau_e_L)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   # Priors for structural parameters</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   alphaBR ~ dnorm(0, 1.0E-6)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   tau_e_BR ~ dgamma(1, 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   tau_u_BR_phylo ~ dgamma(1, 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sigma_BR_phylo &lt;- 1/sqrt(tau_u_BR_phylo)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   lambdaBR &lt;- (1/tau_u_BR_phylo) / ((1/tau_u_BR_phylo) + (1/tau_e_BR))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sigma_BR_res &lt;- 1/sqrt(tau_e_BR)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   alphaS ~ dnorm(0, 1.0E-6)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   tau_e_S ~ dgamma(1, 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   tau_u_S_phylo ~ dgamma(1, 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sigma_S_phylo &lt;- 1/sqrt(tau_u_S_phylo)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   lambdaS &lt;- (1/tau_u_S_phylo) / ((1/tau_u_S_phylo) + (1/tau_e_S))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sigma_S_res &lt;- 1/sqrt(tau_e_S)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   alphaG ~ dnorm(0, 1.0E-6)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   tau_e_G ~ dgamma(1, 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   tau_u_G_phylo ~ dgamma(1, 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sigma_G_phylo &lt;- 1/sqrt(tau_u_G_phylo)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   lambdaG &lt;- (1/tau_u_G_phylo) / ((1/tau_u_G_phylo) + (1/tau_e_G))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sigma_G_res &lt;- 1/sqrt(tau_e_G)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   alphaL ~ dnorm(0, 1.0E-6)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   tau_e_L ~ dgamma(1, 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   tau_u_L_phylo ~ dgamma(1, 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sigma_L_phylo &lt;- 1/sqrt(tau_u_L_phylo)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   lambdaL &lt;- (1/tau_u_L_phylo) / ((1/tau_u_L_phylo) + (1/tau_e_L))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sigma_L_res &lt;- 1/sqrt(tau_e_L)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   beta_BR_BM ~ dnorm(0, 1.0E-6)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   beta_S_BR ~ dnorm(0, 1.0E-6)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   beta_G_BR ~ dnorm(0, 1.0E-6)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   beta_L_BR ~ dnorm(0, 1.0E-6)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   for (k in 1:Ntree) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     p[k] &lt;- 1 / Ntree</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   K ~ dcat(p[])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Achaz von Hardenberg.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

