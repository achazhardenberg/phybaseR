% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/because_model.R
\name{because_model}
\alias{because_model}
\title{Generate a JAGS model string for Phylogenetic Bayesian SEM (Because)}
\usage{
because_model(
  equations,
  multi.tree = FALSE,
  latent_method = "correlations",
  structure_names = "phylo",
  random_structure_names = NULL,
  random_terms = list(),
  vars_with_na = NULL,
  induced_correlations = NULL,
  variability = NULL,
  distribution = NULL,
  optimise = TRUE,
  standardize_latent = TRUE,
  poly_terms = NULL,
  latent = NULL,
  fix_residual_variance = NULL
)
}
\arguments{
\item{equations}{A list of model formulas.}

\item{multi.tree}{Logical; if \code{TRUE}, incorporates phylogenetic uncertainty by sampling across a set of trees.}

\item{structure_names}{(Internal) Character vector of names for multiple trees/structures.}

\item{vars_with_na}{Optional character vector of response variable names that have missing data.
These variables will use element-wise likelihoods instead of multivariate normal.}

\item{induced_correlations}{Optional list of variable pairs with induced correlations
from latent variables. Each element should be a character vector of length 2 specifying
the pair of variables that share a latent common cause.}

\item{variability}{Optional character vector or named character vector of variable names that have measurement error or within-species variability.
If named, the names should be the variable names and the values should be the type of variability: "se" (for mean and standard error) or "reps" (for repeated measures).
If unnamed, it defaults to "se" for all specified variables.
\itemize{
  \item "se": Expects \code{Var_mean} and \code{Var_se} in the data. The model fixes observation error: \code{Var_mean ~ dnorm(Var, 1/Var_se^2)}.
  \item "reps": Expects \code{Var_obs} (matrix) and \code{N_reps_Var} (vector) in the data. The model estimates observation error: \code{Var_obs[i,j] ~ dnorm(Var[i], Var_tau)}.
}}

\item{distribution}{Optional named character vector specifying the distribution for response variables.
Default is "gaussian" for all variables. Supported values: "gaussian", "binomial", "multinomial".
For "binomial" variables, the model uses a logit link and a Bernoulli likelihood, with phylogenetic correlation modeled on the latent scale.}

\item{optimise}{Logical. If TRUE (default), use random effects formulation for 4.6Ã— speedup.
If FALSE, use original marginal covariance formulation.}

\item{standardize_latent}{Logical (default TRUE). If TRUE, standardizes latent variables to unit variance.}

\item{poly_terms}{(Internal) List of polynomial terms for model generation.}

\item{latent}{Optional character vector of latent variable names.}

\item{fix_residual_variance}{Optional numeric value or named vector to fix residual variance.}
}
\value{
A list with two elements:
\itemize{
  \item \code{model}: A character string containing the JAGS model code.
  \item \code{parameter_map}: A data frame mapping response variables to their predictors and parameter names.
}
}
\description{
This function builds the model code to be passed to JAGS based on a set of structural equations.
It supports both single and multiple phylogenetic trees (to account for phylogenetic uncertainty).
Missing values are handled both in the response and predictor variables treating all of them as stochastic nodes.
}
\details{
The generated model includes:
\itemize{
  \item Linear predictors and multivariate normal likelihoods for each response variable.
  \item Priors for intercepts (\code{alpha}), slopes (\code{beta}), lambda parameters (\code{lambda}), and residual precisions (\code{tau}).
  \item Phylogenetic covariance modeled via a single \code{VCV} matrix (when \code{multi.tree = FALSE}) or a 3D array \code{multiVCV[,,K]} with categorical sampling across trees (when \code{multi.tree = TRUE}).
  \item (Optional) Observation models for variables with measurement error:
    \itemize{
      \item Type "se": \code{Var_mean ~ dnorm(Var, 1/Var_se^2)}
      \item Type "reps": \code{Var_obs[i,j] ~ dnorm(Var[i], Var_tau)}
    }
  \item (Optional) Generalized linear mixed models for non-Gaussian responses (e.g., binomial).
  \item (Optional) Element-wise likelihoods for response variables with missing data.
}
}
\examples{
eqs <- list(BR ~ BM, S ~ BR, G ~ BR, L ~ BR)
cat(because_model(eqs, multi.tree = TRUE)$model)

}
