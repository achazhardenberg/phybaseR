model {
  # --- Likelihood ---
  for (i in 1:N) {
    # Observation model
    y[i] ~ dnorm(mu[i], tau[i])
    
    # 1. Mean Model (Location)
    # mu[i] = alpha_m + beta_m * x[i] + phylo_effect_m[i]
    mu[i] <- alpha_m + beta_m * x[i] + u_m[i]
    
    # 2. Variance Model (Scale)
    # log(sigma[i]) = alpha_v + beta_v * x[i] + phylo_effect_v[i]
    # Precision tau = 1/sigma^2
    log_sigma[i] <- alpha_v + beta_v * x[i] + u_v[i]
    sigma[i] <- exp(log_sigma[i])
    tau[i] <- 1 / (sigma[i] * sigma[i])
  }
  
  # --- Random Effects (Phylogenetic) ---
  # We model the vectors u_m and u_v as multivariate normals
  
  # Mean Random Effect
  # u_m ~ MN(0, sigma_phy_m^2 * C)
  # In JAGS: u_m ~ dmnorm(0, Prec_m)
  # Prec_m = inverse(sigma_phy_m^2 * C) = (1/sigma_phy_m^2) * invC
  
  u_std_m[1:N] ~ dmnorm(zeros[1:N], invC[1:N, 1:N])
  
  # Scale by standard deviation
  for (i in 1:N) {
    u_m[i] <- u_std_m[i] * sigma_phy_m
  }
  
  # Variance Random Effect (Log-Scale)
  u_std_v[1:N] ~ dmnorm(zeros[1:N], invC[1:N, 1:N])
  
  for (i in 1:N) {
    u_v[i] <- u_std_v[i] * sigma_phy_v
  }
  
  # --- Priors ---
  
  # Fixed Effects - Mean
  alpha_m ~ dnorm(0, 0.01)
  beta_m  ~ dnorm(0, 0.01)
  
  # Fixed Effects - Variance
  alpha_v ~ dnorm(0, 0.01)
  beta_v  ~ dnorm(0, 0.01)
  
  # Random Effect Variances (Phylogenetic Signal Strength)
  # Half-Cauchy or Uniform priors often used; using Uniform on SD for simplicity here
  sigma_phy_m ~ dunif(0, 10)
  sigma_phy_v ~ dunif(0, 10)
  
  # Convert to variances for comparison with simulation (lambda parameters)
  lambda_m_est <- sigma_phy_m^2 # Approximately (depending on C scaling)
  lambda_v_est <- sigma_phy_v^2
}
